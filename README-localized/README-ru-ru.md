---
page_type: sample
products:
- office-365
- office-outlook
languages:
- javascript
extensions:
  contentType: samples
  createdDate: 9/3/2015 2:30:58 PM
---
# API контактов для Outlook с использованием Node.js и модели приложений версии 2

Этот репозиторий содержит Node.js, подключающийся к единому API контактов для Outlook с помощью модели приложений версии 2 (которая обрабатывает маркеры учетных записей как пользователей, так и бизнеса). Полное описание решения доступно по адресу [http://blogs.msdn.com/b/richard\_dizeregas\_blog/archive/2015/09/04/building-office-365-applications-with-node-js-and-the-azure-ad-v2-app-model.aspx](http://blogs.msdn.com/b/richard_dizeregas_blog/archive/2015/09/04/building-office-365-applications-with-node-js-and-the-azure-ad-v2-app-model.aspx "http://blogs.msdn.com/b/richard_dizeregas_blog/archive/2015/09/04/building-office-365-applications-with-node-js-and-the-azure-ad-v2-app-model.aspx")

## Начало работы ##
Чтобы приступить к работе, создайте копию репозитория и зарегистрируйте приложение на сайте [https://apps.dev.microsoft.com](https://apps.dev.microsoft.com). Приложение следует зарегистрировать для веб-платформы, в которой потребуется указать URL-адрес ответа OAuth. Скопируйте этот URL-адрес ответа, а также идентификатор клиента и секрет приложения в раздел appDetails файла authHelper.js:

	var appDetails = {
	 authority: 'https://login.microsoftonline.com/common',
	 client_id: '1d9e332b-6c7d-4554-8b51-d398fef5f8a7',
	 client_secret: 'Y0tgHpYAy3wQ0eF9NPkMPOf',
	 redirect_url: 'http://localhost:5858/login',
	 scopes: 'openid+https://outlook.office.com/contacts.read+offline_access'
	};

## authHelper.js ##
В решении используется файл authHelper.js, содержащий сведения о регистрации приложения (идентификатор клиента, секрет клиента, URL-адрес ответа, области разрешений и т. д.) и служебные функции для взаимодействия с Azure AD. Ниже описаны три основные служебные функции.

- **getAuthUrl** возвращает конечную точку авторизации в Azure AD со сведениями приложения, объединенными в виде параметров URL-адреса. Приложение может выполнять перенаправление к этой конечной точке, чтобы начать первое действие OAuth.
- **getTokenFromCode** возвращает маркер доступа, используя сведения о регистрации приложения и указанный код авторизации (возвращаемый приложению после входа пользователя и авторизации приложения).
- **getTokenFromRefreshToken** возвращает маркер доступа, используя сведения о регистрации приложения и указанный маркер обновления (который может поступать из кэша).

## Маршруты приложения ##
Решение Node.js было создано для использования Express и Handlebars. Весь поток обрабатывается двумя маршрутами:

**Маршрут индекса**

- Если у пользователя есть кэшированный маркер обновления, используйте его для получения нового маркера
	- Если новый маркер является действительным, получите и отобразите данные
	- Если новый маркер недействителен, отправьте пользователя на вход
- Если у пользователя нет кэшированного маркера обновления, отправьте пользователя на вход

**Маршрут входа**

- Если URL-адрес содержит код авторизации, используйте его для получения маркеров
	- Если маркер является действительным, кэшируйте маркер обновления и отправьте пользователя обратно к индексу
	- Если маркер недействителен, должна произойти ошибка
- Если URL-адрес не содержит код авторизации, получите URL-адрес перенаправления для авторизации и отправьте по нему пользователя

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [часто задаваемых вопросов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).
